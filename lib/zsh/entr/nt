#!/bin/zsh

function nt(){
  # nt [dir] <cmd>
  # use entr to run <cmd> when files in <dir> change
  # if dir not supplied, default to ~/dotfiles
  # run npx ava if in candy repo
  # accepts 1 or more dirs in the -d option

  local directories="$HOME/dotfiles $HOME/.local/bin/scratch"
  while getopts 'd:' opt; do
    case "$opt" in
      d) rootDir=$OPTARG;;
    esac
  done
  shift $(($OPTIND - 1))

  local cmd="$@"

  # -cc clears the screen and scrollback as well
  # prefer entr zsh -c to entr -s
  # entr -s prints the exit code which is noisy
  if [[ $directories == /Users/tim/src/candy/main/referralcandy-main/* ]]; then
    fd . ${=directories} | entr -cc npx ava --fail-fast $cmd
  else
    fd . ${=directories} | entr -cc zsh -c $cmd
  fi
}
